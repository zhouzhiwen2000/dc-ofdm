-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj/hdlsrc/HDLRx/full_rx_ip_src_CRCGenerator.vhd
-- Created: 2024-08-11 11:00:05
-- 
-- Generated by MATLAB 24.1, HDL Coder 24.1, and Simulink 24.1
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: full_rx_ip_src_CRCGenerator
-- Source Path: HDLRx/full_rx/h_rx_full/h_crc_rx/General CRC Syndrome Detector HDL Optimized/CRCGenerator
-- Hierarchy Level: 4
-- Model version: 1.44
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY full_rx_ip_src_CRCGenerator IS
  PORT( clk                               :   IN    std_logic;
        reset_x                           :   IN    std_logic;
        enb_1_2_0                         :   IN    std_logic;
        dataIn                            :   IN    std_logic;  -- ufix1
        startIn                           :   IN    std_logic;  -- ufix1
        endIn                             :   IN    std_logic;  -- ufix1
        validIn                           :   IN    std_logic;  -- ufix1
        dataOut                           :   OUT   std_logic;  -- ufix1
        startOut                          :   OUT   std_logic;  -- ufix1
        endOut                            :   OUT   std_logic;  -- ufix1
        validOut                          :   OUT   std_logic;  -- ufix1
        outputCRC                         :   OUT   std_logic  -- ufix1
        );
END full_rx_ip_src_CRCGenerator;


ARCHITECTURE rtl OF full_rx_ip_src_CRCGenerator IS

  -- Component Declarations
  COMPONENT full_rx_ip_src_CRCGenControl
    PORT( clk                             :   IN    std_logic;
          reset_x                         :   IN    std_logic;
          enb_1_2_0                       :   IN    std_logic;
          startIn                         :   IN    std_logic;  -- ufix1
          endIn                           :   IN    std_logic;  -- ufix1
          validIn                         :   IN    std_logic;  -- ufix1
          startOut                        :   OUT   std_logic;  -- ufix1
          processMsg                      :   OUT   std_logic;  -- ufix1
          padZero                         :   OUT   std_logic;  -- ufix1
          outputCRC                       :   OUT   std_logic;  -- ufix1
          endOut                          :   OUT   std_logic;  -- ufix1
          validOut                        :   OUT   std_logic;  -- ufix1
          counter                         :   OUT   std_logic_vector(3 DOWNTO 0);  -- ufix4
          counter_outputCRC               :   OUT   std_logic_vector(3 DOWNTO 0)  -- ufix4
          );
  END COMPONENT;

  COMPONENT full_rx_ip_src_CRCGenCompute
    PORT( clk                             :   IN    std_logic;
          reset_x                         :   IN    std_logic;
          enb_1_2_0                       :   IN    std_logic;
          datainReg                       :   IN    std_logic;  -- ufix1
          validIn                         :   IN    std_logic;  -- ufix1
          processMsg                      :   IN    std_logic;  -- ufix1
          padZero                         :   IN    std_logic;  -- ufix1
          counter                         :   IN    std_logic_vector(3 DOWNTO 0);  -- ufix4
          crcChecksum                     :   OUT   std_logic_vector(15 DOWNTO 0)  -- ufix1 [16]
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : full_rx_ip_src_CRCGenControl
    USE ENTITY work.full_rx_ip_src_CRCGenControl(rtl);

  FOR ALL : full_rx_ip_src_CRCGenCompute
    USE ENTITY work.full_rx_ip_src_CRCGenCompute(rtl);

  -- Signals
  SIGNAL startIn_vld                      : std_logic;  -- ufix1
  SIGNAL endIn_vld                        : std_logic;  -- ufix1
  SIGNAL tstartout                        : std_logic;  -- ufix1
  SIGNAL processMsg                       : std_logic;  -- ufix1
  SIGNAL padZero                          : std_logic;  -- ufix1
  SIGNAL outputCRC_1                      : std_logic;  -- ufix1
  SIGNAL lastfout                         : std_logic;  -- ufix1
  SIGNAL validdata                        : std_logic;  -- ufix1
  SIGNAL counter                          : std_logic_vector(3 DOWNTO 0);  -- ufix4
  SIGNAL counter_opcrc                    : std_logic_vector(3 DOWNTO 0);  -- ufix4
  SIGNAL const0                           : std_logic;  -- ufix1
  SIGNAL msgenb                           : std_logic;  -- ufix1
  SIGNAL datainReg                        : std_logic;  -- ufix1
  SIGNAL alpha_reg                        : std_logic_vector(15 DOWNTO 0);  -- ufix1 [16]
  SIGNAL dataBuffer                       : std_logic;  -- ufix1
  SIGNAL counter_opcrc_unsigned           : unsigned(3 DOWNTO 0);  -- ufix4
  SIGNAL crcCheckSum                      : std_logic_vector(15 DOWNTO 0);  -- ufix1 [16]
  SIGNAL crcCheckSum_0                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_1                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_2                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_3                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_4                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_5                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_6                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_7                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_8                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_9                    : std_logic;  -- ufix1
  SIGNAL crcCheckSum_10                   : std_logic;  -- ufix1
  SIGNAL crcCheckSum_11                   : std_logic;  -- ufix1
  SIGNAL crcCheckSum_12                   : std_logic;  -- ufix1
  SIGNAL crcCheckSum_13                   : std_logic;  -- ufix1
  SIGNAL crcCheckSum_14                   : std_logic;  -- ufix1
  SIGNAL crcCheckSum_15                   : std_logic;  -- ufix1
  SIGNAL crcOut                           : std_logic;  -- ufix1
  SIGNAL msgcrc                           : std_logic;  -- ufix1
  SIGNAL tdataout                         : std_logic;  -- ufix1

BEGIN
  u_Controlsignal_inst : full_rx_ip_src_CRCGenControl
    PORT MAP( clk => clk,
              reset_x => reset_x,
              enb_1_2_0 => enb_1_2_0,
              startIn => startIn_vld,  -- ufix1
              endIn => endIn_vld,  -- ufix1
              validIn => validIn,  -- ufix1
              startOut => tstartout,  -- ufix1
              processMsg => processMsg,  -- ufix1
              padZero => padZero,  -- ufix1
              outputCRC => outputCRC_1,  -- ufix1
              endOut => lastfout,  -- ufix1
              validOut => validdata,  -- ufix1
              counter => counter,  -- ufix4
              counter_outputCRC => counter_opcrc  -- ufix4
              );

  u_ComputeCRC_inst : full_rx_ip_src_CRCGenCompute
    PORT MAP( clk => clk,
              reset_x => reset_x,
              enb_1_2_0 => enb_1_2_0,
              datainReg => datainReg,  -- ufix1
              validIn => validIn,  -- ufix1
              processMsg => processMsg,  -- ufix1
              padZero => padZero,  -- ufix1
              counter => counter,  -- ufix4
              crcChecksum => crcCheckSum  -- ufix1 [16]
              );

  startIn_vld <= startIn AND validIn;

  endIn_vld <= endIn AND validIn;

  -- Constant Zero
  const0 <= '0';

  msgenb <= processMsg OR padZero;

  datainput_register_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        datainReg <= '0';
      ELSIF enb_1_2_0 = '1' THEN
        datainReg <= dataIn;
      END IF;
    END IF;
  END PROCESS datainput_register_process;


  -- Buffer Input Data
  c_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        alpha_reg <= (OTHERS => '0');
      ELSIF enb_1_2_0 = '1' AND msgenb = '1' THEN
        alpha_reg(0) <= datainReg;
        alpha_reg(15 DOWNTO 1) <= alpha_reg(14 DOWNTO 0);
      END IF;
    END IF;
  END PROCESS c_process;

  dataBuffer <= alpha_reg(15);

  counter_opcrc_unsigned <= unsigned(counter_opcrc);

  -- Select CRC output bits
  crcCheckSum_0 <= crcCheckSum(0);

  -- Select CRC output bits
  crcCheckSum_1 <= crcCheckSum(1);

  -- Select CRC output bits
  crcCheckSum_2 <= crcCheckSum(2);

  -- Select CRC output bits
  crcCheckSum_3 <= crcCheckSum(3);

  -- Select CRC output bits
  crcCheckSum_4 <= crcCheckSum(4);

  -- Select CRC output bits
  crcCheckSum_5 <= crcCheckSum(5);

  -- Select CRC output bits
  crcCheckSum_6 <= crcCheckSum(6);

  -- Select CRC output bits
  crcCheckSum_7 <= crcCheckSum(7);

  -- Select CRC output bits
  crcCheckSum_8 <= crcCheckSum(8);

  -- Select CRC output bits
  crcCheckSum_9 <= crcCheckSum(9);

  -- Select CRC output bits
  crcCheckSum_10 <= crcCheckSum(10);

  -- Select CRC output bits
  crcCheckSum_11 <= crcCheckSum(11);

  -- Select CRC output bits
  crcCheckSum_12 <= crcCheckSum(12);

  -- Select CRC output bits
  crcCheckSum_13 <= crcCheckSum(13);

  -- Select CRC output bits
  crcCheckSum_14 <= crcCheckSum(14);

  -- Select CRC output bits
  crcCheckSum_15 <= crcCheckSum(15);

  
  crcOut <= crcCheckSum_0 WHEN counter_opcrc_unsigned = to_unsigned(16#0#, 4) ELSE
      crcCheckSum_1 WHEN counter_opcrc_unsigned = to_unsigned(16#1#, 4) ELSE
      crcCheckSum_2 WHEN counter_opcrc_unsigned = to_unsigned(16#2#, 4) ELSE
      crcCheckSum_3 WHEN counter_opcrc_unsigned = to_unsigned(16#3#, 4) ELSE
      crcCheckSum_4 WHEN counter_opcrc_unsigned = to_unsigned(16#4#, 4) ELSE
      crcCheckSum_5 WHEN counter_opcrc_unsigned = to_unsigned(16#5#, 4) ELSE
      crcCheckSum_6 WHEN counter_opcrc_unsigned = to_unsigned(16#6#, 4) ELSE
      crcCheckSum_7 WHEN counter_opcrc_unsigned = to_unsigned(16#7#, 4) ELSE
      crcCheckSum_8 WHEN counter_opcrc_unsigned = to_unsigned(16#8#, 4) ELSE
      crcCheckSum_9 WHEN counter_opcrc_unsigned = to_unsigned(16#9#, 4) ELSE
      crcCheckSum_10 WHEN counter_opcrc_unsigned = to_unsigned(16#A#, 4) ELSE
      crcCheckSum_11 WHEN counter_opcrc_unsigned = to_unsigned(16#B#, 4) ELSE
      crcCheckSum_12 WHEN counter_opcrc_unsigned = to_unsigned(16#C#, 4) ELSE
      crcCheckSum_13 WHEN counter_opcrc_unsigned = to_unsigned(16#D#, 4) ELSE
      crcCheckSum_14 WHEN counter_opcrc_unsigned = to_unsigned(16#E#, 4) ELSE
      crcCheckSum_15;

  
  msgcrc <= dataBuffer WHEN outputCRC_1 = '0' ELSE
      crcOut;

  -- Output data and CRC CheckSum
  
  tdataout <= const0 WHEN validdata = '0' ELSE
      msgcrc;

  -- Data output register
  dataOut_register_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        dataOut <= '0';
      ELSIF enb_1_2_0 = '1' THEN
        dataOut <= tdataout;
      END IF;
    END IF;
  END PROCESS dataOut_register_process;


  -- startOut output register
  startOut_register_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        startOut <= '0';
      ELSIF enb_1_2_0 = '1' THEN
        startOut <= tstartout;
      END IF;
    END IF;
  END PROCESS startOut_register_process;


  -- endOut output register
  endout_register_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        endOut <= '0';
      ELSIF enb_1_2_0 = '1' THEN
        endOut <= lastfout;
      END IF;
    END IF;
  END PROCESS endout_register_process;


  -- validOut output register
  validout_register_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        validOut <= '0';
      ELSIF enb_1_2_0 = '1' THEN
        validOut <= validdata;
      END IF;
    END IF;
  END PROCESS validout_register_process;


  outputCRC <= outputCRC_1;

END rtl;

